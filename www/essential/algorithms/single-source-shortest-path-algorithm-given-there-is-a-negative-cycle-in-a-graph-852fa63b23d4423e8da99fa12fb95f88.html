<!doctype html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="referrer" content="always">

  <meta name="twitter:card" value="summary">
  <meta name="twitter:site" content="@kjk">
  <meta name="twitter:title" content="Single Source Shortest Path Algorithm (Given there is a negative cycle in a graph)">
  
  <meta name="twitter:description" content="Single Source Shortest Path Algorithm (Given there is a negative cycle in a graph)">
  <meta name="twitter:creator" content="@kjk">
  <meta name="twitter:image" content="/essential/algorithms/covers/twitter/Algorithms.png">
  
  <meta property="og:title" content="Single Source Shortest Path Algorithm (Given there is a negative cycle in a graph)">
  <meta property="og:type" content="article" />
  <meta property="og:url" content="/essential/algorithms/single-source-shortest-path-algorithm-given-there-is-a-negative-cycle-in-a-graph-852fa63b23d4423e8da99fa12fb95f88" />
  
  <meta property="og:description" content="Single Source Shortest Path Algorithm (Given there is a negative cycle in a graph)">
  <meta property="og:image" content="/essential/algorithms/covers/twitter/Algorithms.png">

  <title>Bellman-For Algorithm / Single Source Shortest Path Algorithm (Given there is a negative cycle in a graph) / Essential Algorithms</title>
  <meta name="description" content="Bellman-For Algorithm / Single Source Shortest Path Algorithm (Given there is a negative cycle in a graph) / Essential Algorithms">

  <link rel="icon" href="s/favicon-9dfe2f70.ico">

  <link href="s/main-65ff0b86.css" rel="stylesheet">
  <link href="s/bundle-83cf4538.css" rel="stylesheet">

  
  <script src="s/app-algorithms-a02ce0ea.js" defer></script>
  <script src="s/bundle-fd6a7ad6.js" defer></script>
</head>

<body class="page">
  <script>
  function onLoad() {
    gBookTitle = "Essential Algorithms";

    httpsMaybeRedirect();

    let opts = {
      target: document.getElementById("toc"),
      props: {
        parentIdx: -1,
        level: 0,
      },
    };
    new app.toc(opts);

    opts = {
      target: document.getElementById("search-parent"),
      props: {
        bookTitle: gBookTitle,
      },
    };
    new app.searchInput(opts);

    opts = {
      target: document.getElementById("page-toc"),
    };
    new app.pageToc(opts);

    opts = {
      target: document.getElementById("book-toc"),
    };
    new app.bookToc(opts);
  }
  document.addEventListener('DOMContentLoaded', onLoad);
</script>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none">
  <symbol id="arrow-expanded" viewbox="0 0 16 16">
    <path fill="%23646465" d="M11 10H5.344L11 4.414V10z" />
  </symbol>

  <symbol id="arrow-not-expanded" viewbox="0 0 16 16">
    <path fill="%23646465" d="M6 4v8l4-4-4-4zm1 2.414L8.586 8 7 9.586V6.414z" />
  </symbol>

  <symbol id="icon-github" viewbox="0 0 496 512">
    <path
      d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" />
  </symbol>

  <symbol id="icon-home" viewbox="0 0 576 512">
    <path
      d="M488 312.7V456c0 13.3-10.7 24-24 24H348c-6.6 0-12-5.4-12-12V356c0-6.6-5.4-12-12-12h-72c-6.6 0-12 5.4-12 12v112c0 6.6-5.4 12-12 12H112c-13.3 0-24-10.7-24-24V312.7c0-3.6 1.6-7 4.4-9.3l188-154.8c4.4-3.6 10.8-3.6 15.3 0l188 154.8c2.7 2.3 4.3 5.7 4.3 9.3zm83.6-60.9L488 182.9V44.4c0-6.6-5.4-12-12-12h-56c-6.6 0-12 5.4-12 12V117l-89.5-73.7c-17.7-14.6-43.3-14.6-61 0L4.4 251.8c-5.1 4.2-5.8 11.8-1.6 16.9l25.5 31c4.2 5.1 11.8 5.8 16.9 1.6l235.2-193.7c4.4-3.6 10.8-3.6 15.3 0l235.2 193.7c5.1 4.2 12.7 3.5 16.9-1.6l25.5-31c4.2-5.2 3.4-12.7-1.7-16.9z" />
  </symbol>

  <symbol id="icon-twitter" viewbox="0 0 512 512">
    <path
      d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" />
  </symbol>

  <symbol id="icon-edit" viewbox="0 0 576 512">
    <path
      d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z" />
  </symbol>

  <symbol id="icon-star" viewbox="0 0 576 512">
    <path
      d="M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z" />
  </symbol>
</svg>
  <header class="page__header">
  <div class="page__header__left">
    <a id="link-home" href="index.html">
      <svg class="icon-home">
        <use xlink:href="#icon-home"></use>
      </svg>
      &nbsp;Essential Algorithms</a>
  </div>
  <div class="page__header__center" id="search-parent">
  </div>
  <div class="page__header__right">
  </div>
</header>

  <div id="toc"></div>

  <div class="content">
    <div class="article">
      

<div style="display: flex; justify-content: space-between">
  <h1 class="title">Single Source Shortest Path Algorithm (Given there is a negative cycle in a graph)</h1>
  <a class="edit-link" style="font-size: 80%" href="https://notion.so/852fa63b23d4423e8da99fa12fb95f88" rel="nofollow"
  target="_blank">suggest change</a>
</div>


      <p><em>Before reading this example, it is required to have a brief idea on edge-relaxation. You can learn it from </em><a href="http://stackoverflow.com/documentation/algorithm/7151/dijkstra-s-algorithm#t=201610020826272688942"><em>here</em></a></p><p><a href="https://en.wikipedia.org/wiki/Bellman%E2%80%93Ford_algorithm">Bellman-Ford</a> Algorithm is computes the shortest paths from a single source vertex to all of the other vertices in a weighted digraph. Even though it is slower than <a href="http://stackoverflow.com/documentation/algorithm/7151/dijkstra-s-algorithm#t=201610020826272688942">Dijkstra’s Algorithm</a>, it works in the cases when the weight of the edge is negative and it also finds negative weight cycle in the graph. The problem with Dijkstra’s Algorithm is, if there’s a negative cycle, you keep going through the cycle again and again and keep reducing the distance between two vertices.</p><p>The idea of this algorithm is to go through all the edges of this graph one-by-one in some random order. It can be any random order. But you must ensure, if <strong>u-v</strong> (where <strong>u</strong> and <strong>v</strong> are two vertices in a graph) is one of your orders, then there must be an edge from <strong>u</strong> to <strong>v</strong>. Usually it is taken directly from the order of the input given. Again, any random order will work.</p><p>After selecting the order, we will <em>relax</em> the edges according to the relaxation formula. For a given edge <strong>u-v</strong> going from <strong>u</strong> to <strong>v</strong> the relaxation formula is:</p>
<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">if distance[u] + cost[u][v] &lt; d[v]
    d[v] = d[u] + cost[u][v]</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div><p>That is, if the distance from <strong>source</strong> to any vertex <strong>u</strong> + the weight of the <strong>edge u-v</strong> is less than the distance from <strong>source</strong> to another vertex <strong>v</strong>, we update the distance from <strong>source</strong> to <strong>v</strong>. We need to <em>relax</em> the edges at most <strong>(V-1)</strong> times where <strong>V</strong> is the number of edges in the graph. Why <strong>(V-1)</strong> you ask? We’ll explain it in another example. Also we are going to keep track of the parent vertex of any vertex, that is when we relax an edge, we will set:</p>
<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">parent[v] = u</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div><p>It means we’ve found another shorter path to reach <strong>v</strong> via <strong>u</strong>. We will need this later to print the shortest path from <strong>source</strong> to the destined vertex.</p><p>Let’s look at an example. We have a graph:</p><img class="img" src="/img/9f151cd289fbba8d165bbf16a12abd55cb878fb4.png"><p>We have selected <strong>1</strong> as the <strong>source</strong> vertex. We want to find out the shortest path from the <strong>source</strong> to all other vertices.</p><p>At first, <strong>d[1] = 0</strong> because it is the source. And rest are <em>infinity</em>, because we don’t know their distance yet.</p><p>We will relax the edges in this sequence:</p>
<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">+--------+--------+--------+--------+--------+--------+--------+
| Serial |    1   |    2   |    3   |    4   |    5   |    6   |
+--------+--------+--------+--------+--------+--------+--------+
|  Edge  |  4-&gt;5  |  3-&gt;4  |  1-&gt;3  |  1-&gt;4  |  4-&gt;6  |  2-&gt;3  |
+--------+--------+--------+--------+--------+--------+--------+</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div><p>You can take any sequence you want. If we <em>relax</em> the edges once, what do we get? We get the distance from <strong>source</strong> to all other vertices of the path that uses at most 1 edge. Now let’s relax the edges and update the values of <strong>d[]</strong>. We get:</p><ol id="70770ecc-c3cd-4a05-acd5-c55de3e1971f" class="numbered-list" start="1"><li><strong>d[4]</strong> + <strong>cost[4][5]</strong> = <strong>infinity</strong> + <strong>7</strong> = <strong>infinity</strong>. We can’t update this one.</li><li><strong>d[2]</strong> + <strong>cost[3][4]</strong> = <strong>infinity</strong>. We can’t update this one.</li><li><strong>d[1]</strong> + <strong>cost[1][2]</strong> = <strong>0</strong> + <strong>2</strong> = <strong>2</strong> &lt; <strong>d[2]</strong>. So <strong>d[2]</strong> = <strong>2</strong>. Also <strong>parent[2] = 1</strong>.</li><li><strong>d[1]</strong> + <strong>cost[1][4]</strong> = <strong>4</strong>. So <strong>d[4] = 4</strong> &lt; <strong>d[4]</strong>. <strong>parent[4]</strong> = <strong>1</strong>.</li><li><strong>d[4]</strong> + <strong>cost[4][6]</strong> = <strong>9</strong>. <strong>d[6]</strong> = <strong>9</strong> &lt; <strong>d[6]</strong>. <strong>parent[6]</strong> = <strong>4</strong>.</li><li><strong>d[2]</strong> + <strong>cost[2][2]</strong> = <strong>infinity</strong>. We can’t update this one.</li></ol><p>We couldn’t update some vertices, because the <code>d[u] + cost[u][v] &lt; d[v]</code> condition didn’t match. As we have said before, we found the paths from <strong>source</strong> to other nodes using maximum 1 edge.</p><img class="img" src="/img/1262386dd557d2fabf12300456c6b2573feb1946.png"><p>Our second iteration will provide us with the path using 2 nodes. We get:</p><ol id="5df8a43f-152f-47a1-9a11-ef248c43a51a" class="numbered-list" start="1"><li><strong>d[4]</strong> + <strong>cost[4][5]</strong> = <strong>12</strong> &lt; <strong>d[5]</strong>. <strong>d[5]</strong> = <strong>12</strong>. <strong>parent[5]</strong> = <strong>4</strong>.</li><li><strong>d[3]</strong> + <strong>cost[3][4]</strong> = <strong>1</strong> &lt; <strong>d[4]</strong>. <strong>d[4]</strong> = <strong>1</strong>. <strong>parent[4]</strong> = <strong>3</strong>.</li><li><strong>d[3]</strong> remains unchanged.</li><li><strong>d[4]</strong> remains unchanged.</li><li><strong>d[4]</strong> + <strong>cost[4][6]</strong> = <strong>6</strong> &lt; <strong>d[6]</strong>. <strong>d[6]</strong> = <strong>6</strong>. <strong>parent[6]</strong> = <strong>4</strong>.</li><li><strong>d[3]</strong> remains unchanged.</li></ol><p>Our graph will look like:</p><img class="img" src="/img/4eabf4cf0c7b033a001caf6a4ec520965dc2d400.png"><p>Our 3rd iteration will only update <strong>vertex 5</strong>, where <strong>d[5]</strong> will be <strong>8</strong>. Our graph will look like:</p><img class="img" src="/img/c1ea559c49782bb9e3ab944876836fc5bcbf45e7.png"><p>After this no matter how many iterations we do, we’ll have the same distances. So we will keep a flag that checks if any update takes place or not. If it doesn’t, we’ll simply break the loop. Our pseudo-code will be:</p>
<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">Procedure Bellman-Ford(Graph, source):
n := number of vertices in Graph
for i from 1 to n
    d[i] := infinity
    parent[i] := NULL
end for
d[source] := 0
for i from 1 to n-1
    flag := false
    for all edges from (u,v) in Graph
        if d[u] + cost[u][v] &lt; d[v]
            d[v] := d[u] + cost[u][v]
            parent[v] := u
            flag := true
        end if
    end for
    if flag == false
        break
end for
Return d</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div><p>To keep track of negative cycle, we can modify our code using the procedure described <a href="http://stackoverflow.com/documentation/algorithm/4791/bellman-ford-algorithm/24034/detecting-negative-cycle-in-a-graph">here</a>. Our completed pseudo-code will be:</p>
<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">Procedure Bellman-Ford-With-Negative-Cycle-Detection(Graph, source):
n := number of vertices in Graph
for i from 1 to n
    d[i] := infinity
    parent[i] := NULL
end for
d[source] := 0
for i from 1 to n-1
    flag := false
    for all edges from (u,v) in Graph
        if d[u] + cost[u][v] &lt; d[v]
            d[v] := d[u] + cost[u][v]
            parent[v] := u
            flag := true
        end if
    end for
    if flag == false
        break
end for
for all edges from (u,v) in Graph
    if d[u] + cost[u][v] &lt; d[v]
        Return &#34;Negative Cycle Detected&#34;
    end if
end for
Return d</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div><p><strong>Printing Path:</strong></p><p>To print the shortest path to a vertex, we’ll iterate back to its parent until we find <strong>NULL</strong> and then print the vertices. The pseudo-code will be:</p>
<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">Procedure PathPrinting(u)
v := parent[u]
if v == NULL
    return
PathPrinting(v)
print -&gt; u</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div><p><strong>Complexity:</strong></p><p>Since we need to relax the edges maximum <strong>(V-1)</strong> times, the time complexity of this algorithm will be equal to <strong>O(V * E)</strong> where <strong>E</strong> denotes the number of edges, if we use <code>adjacency list</code> to represent the graph. However, if <code>adjacency matrix</code> is used to represent the graph, time complexity will be <strong>O(V^3)</strong>. Reason is we can iterate through all edges in <strong>O(E)</strong> time when <code>adjacency list</code> is used, but it takes <strong>O(V^2)</strong> time when <code>adjacency matrix</code> is used.</p>

      <div class="forum-link">
  Found a mistake? Have a question or improvement idea?
  <a href="#" onclick="showContact(); return false;">Let me know</a>.
</div>

      <form id="contact-form" action="https://formsubmit.co/kkowalczyk@gmail.com" method="POST">
  <p>
    <div class="contact-light">Feedback about page:</div>
    <input type="text" name="page-url" id="contact-page-url" readonly />
  </p>

  <p>
    <div class="contact-light">Feedback:</div>
    <textarea name="message" id="msg-for-chris"></textarea>
    <div class="contact-light">Optional: your email if you want me to get back to you: </div>
    <input type="email" name="email" />
    <input type="text" name="_honey" style="display:none">
  </p>

  <p>
    <button type="submit" class="contact-btn">
      Send Feedback
    </button>

    <button class="contact-btn" style="float: right;" onclick="hideContact(); return false;">
      Cancel
    </button>
  </p>

  <p>
    <div data-netlify-recaptcha></div>
  </p>
</form>


      <hr class="article-bottom-sep">
    </div>

    <div id="page-toc"></div>

    <div id="chapter-toc-wrapper">
      <hr />
      <div class="hdr">Table Of Contents</div>
      <div id="book-toc"></div>
    </div>
  </div>

  <footer class="page__footer">
  <div class="page__footer__left">
    Maintained by
    <a href="https://blog.kowalczyk.info" target="_blank">Krzysztof Kowalczyk</a>
  </div>
  <div class="share-me">
    <a href="https://twitter.com/intent/tweet?text=%22Essential%20Algorithms%22%20-%20a%20free%20programming%20book&url=%2fessential%2falgorithms%2f&via=kjk">Share
      <b>Essential Algorithms</b> on&nbsp;
      <svg class="icon-twitter">
        <use xlink:href="#icon-twitter"></use>
      </svg>
    </a>
  </div>
  <div class="page__footer__right">
    
  </div>
</footer>

  

</body>

</html>