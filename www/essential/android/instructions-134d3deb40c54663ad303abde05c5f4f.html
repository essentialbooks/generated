<!doctype html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="referrer" content="always">

  <meta name="twitter:card" value="summary">
  <meta name="twitter:site" content="@kjk">
  <meta name="twitter:title" content="Instructions">
  
  <meta name="twitter:description" content="Instructions">
  <meta name="twitter:creator" content="@kjk">
  <meta name="twitter:image" content="https://www.programming-books.io/covers/twitter/Android.png">
  
  <meta property="og:title" content="Instructions">
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://www.programming-books.io/essential/android/instructions-134d3deb40c54663ad303abde05c5f4f" />
  
  <meta property="og:description" content="Instructions">
  <meta property="og:image" content="https://www.programming-books.io/covers/twitter/Android.png">

  <title>OpenCV / Instructions / Essential Android</title>
  <meta name="description" content="OpenCV / Instructions / Essential Android">
  <link rel="icon" href="/s/favicon.ico">
  <link href="/s/main.css" rel="stylesheet">
  <link href="/s/bundle.css" rel="stylesheet">
  <script src="/s/app-android.js" defer></script>
  <script src="/s/bundle.js" defer></script>
</head>

<body class="page">
  <script>
  function onLoad() {
    gBookTitle = "Essential Android";

    httpsMaybeRedirect();

    let opts = {
      target: document.getElementById("toc"),
      props: {
        parentIdx: -1,
        level: 0,
      },
    };
    new app.toc(opts);

    opts = {
      target: document.getElementById("search-parent"),
      props: {
        bookTitle: gBookTitle,
      },
    };
    new app.searchInput(opts);

    opts = {
      target: document.getElementById("page-toc"),
    };
    new app.pageToc(opts);

    opts = {
      target: document.getElementById("book-toc"),
    };
    new app.bookToc(opts);
  }
  document.addEventListener('DOMContentLoaded', onLoad);
</script>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none">
  <symbol id="arrow-expanded" viewbox="0 0 16 16">
    <path fill="%23646465" d="M11 10H5.344L11 4.414V10z" />
  </symbol>

  <symbol id="arrow-not-expanded" viewbox="0 0 16 16">
    <path fill="%23646465" d="M6 4v8l4-4-4-4zm1 2.414L8.586 8 7 9.586V6.414z" />
  </symbol>

  <symbol id="icon-github" viewbox="0 0 496 512">
    <path
      d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" />
  </symbol>

  <symbol id="icon-home" viewbox="0 0 576 512">
    <path
      d="M488 312.7V456c0 13.3-10.7 24-24 24H348c-6.6 0-12-5.4-12-12V356c0-6.6-5.4-12-12-12h-72c-6.6 0-12 5.4-12 12v112c0 6.6-5.4 12-12 12H112c-13.3 0-24-10.7-24-24V312.7c0-3.6 1.6-7 4.4-9.3l188-154.8c4.4-3.6 10.8-3.6 15.3 0l188 154.8c2.7 2.3 4.3 5.7 4.3 9.3zm83.6-60.9L488 182.9V44.4c0-6.6-5.4-12-12-12h-56c-6.6 0-12 5.4-12 12V117l-89.5-73.7c-17.7-14.6-43.3-14.6-61 0L4.4 251.8c-5.1 4.2-5.8 11.8-1.6 16.9l25.5 31c4.2 5.1 11.8 5.8 16.9 1.6l235.2-193.7c4.4-3.6 10.8-3.6 15.3 0l235.2 193.7c5.1 4.2 12.7 3.5 16.9-1.6l25.5-31c4.2-5.2 3.4-12.7-1.7-16.9z" />
  </symbol>

  <symbol id="icon-twitter" viewbox="0 0 512 512">
    <path
      d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" />
  </symbol>

  <symbol id="icon-edit" viewbox="0 0 576 512">
    <path
      d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z" />
  </symbol>

  <symbol id="icon-star" viewbox="0 0 576 512">
    <path
      d="M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z" />
  </symbol>
</svg>
  <header class="page__header">
  <div class="page__header__left">
    <a id="link-home" href="index.html">
      <svg class="icon-home">
        <use xlink:href="#icon-home"></use>
      </svg>
      &nbsp;Essential Android</a>
  </div>
  <div class="page__header__center" id="search-parent">
  </div>
  <div class="page__header__right">
  </div>
</header>

  <div id="toc"></div>

  <div class="content">
    <div class="article">
      

<div style="display: flex; justify-content: space-between">
  <h1 class="title">Instructions</h1>
  <a class="edit-link" style="font-size: 80%" href="https://notion.so/134d3deb40c54663ad303abde05c5f4f" rel="nofollow"
  target="_blank">suggest change</a>
</div>


      
<p>Tested with A.S. v1.4.1 but should work with newer versions too.
</p>
  <ol id="8cb57c9c-553e-4026-93a4-00362ebe855f" class="numbered-list" start="1">
    <li>Create a new Android Studio project using the project wizard (Menu:/File/New Project):
    </li>
  </ol>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">- Call it &#34;**cvtest1**&#34;
- Form factor:  **API 19, Android 4.4 (KitKat)**
- **Blank Activity** named **MainActivity**

You should have a *cvtest1* directory where this project is stored.  (the title bar of Android studio shows you where cvtest1 is when you open the project)</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
  <ol id="1d1fbaa0-8b2a-4740-8c90-fc3873f1618f" class="numbered-list" start="1">
    <li>Verify that your app runs correctly. Try changing something like the “Hello World” text to confirm that the build/test cycle is OK for you. (I’m testing with an emulator of an API 19 device).
    </li>
    <li>Download the OpenCV package for Android v3.1.0 and unzip it in some temporary directory somewhere. (Make sure it is the package specifically for Android and not just the OpenCV for Java package.) I’ll call this directory “<strong>unzip-dir</strong>” Below <strong>unzip-dir</strong> you should have a <strong>sdk/native/libs</strong> directory with subdirectories that start with things like <strong>arm</strong>…, <strong>mips</strong>… and <strong>x86</strong>… (one for each type of “architecture” Android runs on)
    </li>
    <li>From Android Studio import OpenCV into your project as a module:
    </li>
  </ol>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">**Menu:/File/New/Import_Module**:
   - Source-directory: **{unzip-dir}/sdk/java**
   - Module name:  Android studio automatically fills in this field with **openCVLibrary310** (the exact name probably doesn&#39;t matter but we&#39;ll go with this).
   - Click on **next**.  You get a screen with three checkboxes and questions about jars, libraries and import options.  All three should be checked.  Click on **Finish.**

 Android Studio starts to import the module and you are shown an **import-summary.txt** file that has a list of what was not imported (mostly javadoc files) and other pieces of information.</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<img class="img" src="/essential/android/img/c7a6972e88b282a324bb66f28f62a890a2b89a2d.jpg">

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">But you also get an error message saying **failed to find target with hash string &#39;android-14&#39;...**.  This happens because the build.gradle file in the OpenCV zip file you downloaded says to compile using android API version 14,
   which by default you don&#39;t have with Android Studio v1.4.1.</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<img class="img" src="/essential/android/img/fab9f4edbe11ab50921877f9003b015876af7273.jpg">
  <ol id="70efdd90-5748-4d9e-82a3-6f573888e570" class="numbered-list" start="1">
    <li>Open the project structure dialogue (<strong>Menu:/File/Project_Structure</strong>). Select the “app” module, click on the <strong>Dependencies</strong> tab and add <strong>:openCVLibrary310</strong> as a Module Dependency. When you select <strong>Add/Module_Dependency</strong> it should appear in the list of modules you can add. It will now show up as a dependency but you will get a few more <strong>cannot-find-android-14</strong> errors in the event log.
    </li>
    <li>Look in the <strong>build.gradle</strong> file for your app module. There are multiple build.gradle files in an Android project. The one you want is in the <strong>cvtest1/app</strong> directory and from the project view it looks like <strong>build.gradle (Module: app)</strong>. Note the values of these four fields:
    </li>
  </ol>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">- compileSDKVersion  (mine says 23)
- buildToolsVersion (mine says 23.0.2)
- minSdkVersion (mine says 19)
- targetSdkVersion (mine says 23)</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
  <ol id="2990e1ed-e460-498f-8cbb-c15e21d5ac4a" class="numbered-list" start="1">
    <li>Your project now has a <strong>cvtest1/OpenCVLibrary310</strong> directory but it is not visible from the project view:
    </li>
  </ol>
<img class="img" src="/essential/android/img/0b886dec019c29598d7ffc59fa303c0206ff11d9.png">
<p>Use some other tool, such as any file manager, and go to this directory. You can also switch the project view from <strong>Android</strong> to <strong>Project Files</strong> and you can find this directory as shown in this screenshot:
</p>
<img class="img" src="/essential/android/img/b919651c7b2904db80979ae0d6eb9f1208cfdf4a.png">
<p>Inside there is another <strong>build.gradle</strong> file (it’s highlighted in the above screenshot). Update this file with the four values from step 6.
</p>
  <ol id="c39dd020-3919-4b33-a8a2-e665d5eaa941" class="numbered-list" start="1">
    <li>Resynch your project and then clean/rebuild it. (<strong>Menu:/Build/Clean_Project</strong>) It should clean and build without errors
    </li>
  </ol>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">and you should see many references to **:openCVLibrary310** in the **0:Messages** screen.

[![enter image description here][5]][5]

At this point the module should appear in the project hierarchy as **openCVLibrary310**, just like **app**.  (Note that in that little drop-down menu I switched back from **Project View** to **Android View** ).  You should also see an additional **build.gradle** file under &#34;Gradle Scripts&#34; but I find the Android Studio interface a little bit glitchy and sometimes it does not do this right away.  So try resynching, cleaning, even restarting Android Studio.

You should see the openCVLibrary310 module with all the OpenCV functions under java like in this screenshot:

[![enter image description here][6]][6]</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
  <ol id="6310a484-7d00-4fa1-a22d-a97ad5563338" class="numbered-list" start="1">
    <li>Copy the <strong>{unzip-dir}/sdk/native/libs</strong> directory (and everything under it) to your Android project, to <strong>cvtest1/OpenCVLibrary310/src/main/</strong>, and then rename your copy from <strong>libs</strong> to <strong>jniLibs</strong>. You should now have a <strong>cvtest1/OpenCVLibrary310/src/main/jniLibs</strong> directory. Resynch your project and this directory should now appear in the project view under <strong>openCVLibrary310</strong>.
    </li>
  </ol>
<img class="img" src="/essential/android/img/23d72a903f524875f49ea71955bd885de4188546.png">
  <ol id="52e2e745-50a3-4006-8634-289a5f094bc6" class="numbered-list" start="1">
    <li>Go to the onCreate method of <em>MainActivity.java</em> and append this code:
    </li>
  </ol>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">if (!OpenCVLoader.initDebug()) {
        Log.e(this.getClass().getSimpleName(), &#34;  OpenCVLoader.initDebug(), not working.&#34;);
    } else {
        Log.d(this.getClass().getSimpleName(), &#34;  OpenCVLoader.initDebug(), working.&#34;);
    }</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Then run your application. You should see lines like this in the Android Monitor:
</p>
<img class="img" src="/essential/android/img/00eb3f9b01ae147069485cecd89fb1c7e072b772.jpg">
<p>(I don’t know why that line with the error message is there)
</p>
  <ol id="887c38e1-b00f-441b-8028-8cb72b8bced7" class="numbered-list" start="1">
    <li>Now try to actually use some openCV code. In the example below I copied a .jpg file to the cache directory of the cvtest1 application on the android emulator. The code below loads this image, runs the canny edge detection algorithm and then writes the results back to a .png file in the same directory.
    </li>
  </ol>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">Put this code just below the code from the previous step and alter it to match your own files/directories.
 
    String inputFileName=&#34;simm_01&#34;;
    String inputExtension = &#34;jpg&#34;;
    String inputDir = getCacheDir().getAbsolutePath();  // use the cache directory for i/o
    String outputDir = getCacheDir().getAbsolutePath();
    String outputExtension = &#34;png&#34;;
    String inputFilePath = inputDir + File.separator + inputFileName + &#34;.&#34; + inputExtension;</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">Log.d (this.getClass().getSimpleName(), &#34;loading &#34; + inputFilePath + &#34;...&#34;);
Mat image = Imgcodecs.imread(inputFilePath);  
Log.d (this.getClass().getSimpleName(), &#34;width of &#34; + inputFileName + &#34;: &#34; + image.width());
// if width is 0 then it did not read your image.</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">// for the canny edge detection algorithm, play with these to see different results
int threshold1 = 70;
int threshold2 = 100;

Mat im_canny = new Mat();  // you have to initialize output image before giving it to the Canny method
Imgproc.Canny(image, im_canny, threshold1, threshold2);
String cannyFilename = outputDir + File.separator + inputFileName + &#34;_canny-&#34; + threshold1 + &#34;-&#34; + threshold2 + &#34;.&#34; + outputExtension;
Log.d (this.getClass().getSimpleName(), &#34;Writing &#34; + cannyFilename);
Imgcodecs.imwrite(cannyFilename, im_canny);</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
  <ol id="9ebe0a6f-9b21-4670-b992-4c09b43edc83" class="numbered-list" start="1">
    <li>Run your application. Your emulator should create a black and white “edge” image. You can use the Android Device Monitor to retrieve the output or write an activity to show it.
    </li>
  </ol>

      <div class="forum-link">
  Found a mistake? Have a question or improvement idea?
  <a href="#" onclick="showContact(); return false;">Let me know</a>.
</div>

      <form id="contact-form" action="https://formsubmit.co/kkowalczyk@gmail.com" method="POST">
  <p>
    <div class="contact-light">Feedback about page:</div>
    <input type="text" name="page-url" id="contact-page-url" readonly />
  </p>

  <p>
    <div class="contact-light">Feedback:</div>
    <textarea name="message" id="msg-for-chris"></textarea>
    <div class="contact-light">Optional: your email if you want me to get back to you: </div>
    <input type="email" name="email" />
    <input type="text" name="_honey" style="display:none">
  </p>

  <p>
    <button type="submit" class="contact-btn">
      Send Feedback
    </button>

    <button class="contact-btn" style="float: right;" onclick="hideContact(); return false;">
      Cancel
    </button>
  </p>

  <p>
    <div data-netlify-recaptcha></div>
  </p>
</form>


      <hr class="article-bottom-sep">
    </div>

    <div id="page-toc"></div>

    <div id="chapter-toc-wrapper">
      <hr />
      <div class="hdr">Table Of Contents</div>
      <div id="book-toc"></div>
    </div>
  </div>

  <footer class="page__footer">
  <div class="page__footer__left">
    Maintained by
    <a href="https://blog.kowalczyk.info" target="_blank">Krzysztof Kowalczyk</a>
  </div>
  <div class="share-me">
    <a href="https://twitter.com/intent/tweet?text=%22Essential%20Android%22%20-%20a%20free%20programming%20book&url=https%3a%2f%2fwww.programming-books.io%2fessential%2fandroid%2f&via=kjk">Share
      <b>Essential Android</b> on&nbsp;
      <svg class="icon-twitter">
        <use xlink:href="#icon-twitter"></use>
      </svg>
    </a>
  </div>
  <div class="page__footer__right">
    
  </div>
</footer>

  

</body>

</html>