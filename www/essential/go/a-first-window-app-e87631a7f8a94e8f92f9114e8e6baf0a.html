<!doctype html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="referrer" content="always">

  <meta name="twitter:card" value="summary">
  <meta name="twitter:site" content="@kjk">
  <meta name="twitter:title" content="A first window app">
  
  <meta name="twitter:description" content="A first window app">
  <meta name="twitter:creator" content="@kjk">
  <meta name="twitter:image" content="https://www.programming-books.io/covers/twitter/Go.png">
  
  <meta property="og:title" content="A first window app">
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://www.programming-books.io/essential/go/a-first-window-app-e87631a7f8a94e8f92f9114e8e6baf0a" />
  
  <meta property="og:description" content="A first window app">
  <meta property="og:image" content="https://www.programming-books.io/covers/twitter/Go.png">

  <title>Windows GUI programming / A first window app / Essential Go</title>
  <meta name="description" content="Windows GUI programming / A first window app / Essential Go">
  <link rel="icon" href="/s/favicon.ico">
  <link href="/s/main.css" rel="stylesheet">
  <link href="/s/bundle.css" rel="stylesheet">
  <script src="/s/app-go.js" defer></script>
  <script src="/s/bundle.js" defer></script>
</head>

<body class="page">
  <script>
  function onLoad() {
    gBookTitle = "Essential Go";

    httpsMaybeRedirect();

    let opts = {
      target: document.getElementById("toc"),
      props: {
        parentIdx: -1,
        level: 0,
      },
    };
    new app.toc(opts);

    opts = {
      target: document.getElementById("search-parent"),
      props: {
        bookTitle: gBookTitle,
      },
    };
    new app.searchInput(opts);

    opts = {
      target: document.getElementById("page-toc"),
    };
    new app.pageToc(opts);

    opts = {
      target: document.getElementById("book-toc"),
    };
    new app.bookToc(opts);
  }
  document.addEventListener('DOMContentLoaded', onLoad);
</script>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none">
  <symbol id="arrow-expanded" viewbox="0 0 16 16">
    <path fill="%23646465" d="M11 10H5.344L11 4.414V10z" />
  </symbol>

  <symbol id="arrow-not-expanded" viewbox="0 0 16 16">
    <path fill="%23646465" d="M6 4v8l4-4-4-4zm1 2.414L8.586 8 7 9.586V6.414z" />
  </symbol>

  <symbol id="icon-github" viewbox="0 0 496 512">
    <path
      d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" />
  </symbol>

  <symbol id="icon-home" viewbox="0 0 576 512">
    <path
      d="M488 312.7V456c0 13.3-10.7 24-24 24H348c-6.6 0-12-5.4-12-12V356c0-6.6-5.4-12-12-12h-72c-6.6 0-12 5.4-12 12v112c0 6.6-5.4 12-12 12H112c-13.3 0-24-10.7-24-24V312.7c0-3.6 1.6-7 4.4-9.3l188-154.8c4.4-3.6 10.8-3.6 15.3 0l188 154.8c2.7 2.3 4.3 5.7 4.3 9.3zm83.6-60.9L488 182.9V44.4c0-6.6-5.4-12-12-12h-56c-6.6 0-12 5.4-12 12V117l-89.5-73.7c-17.7-14.6-43.3-14.6-61 0L4.4 251.8c-5.1 4.2-5.8 11.8-1.6 16.9l25.5 31c4.2 5.1 11.8 5.8 16.9 1.6l235.2-193.7c4.4-3.6 10.8-3.6 15.3 0l235.2 193.7c5.1 4.2 12.7 3.5 16.9-1.6l25.5-31c4.2-5.2 3.4-12.7-1.7-16.9z" />
  </symbol>

  <symbol id="icon-twitter" viewbox="0 0 512 512">
    <path
      d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" />
  </symbol>

  <symbol id="icon-edit" viewbox="0 0 576 512">
    <path
      d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z" />
  </symbol>

  <symbol id="icon-star" viewbox="0 0 576 512">
    <path
      d="M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z" />
  </symbol>
</svg>
  <header class="page__header">
  <div class="page__header__left">
    <a id="link-home" href="index.html">
      <svg class="icon-home">
        <use xlink:href="#icon-home"></use>
      </svg>
      &nbsp;Essential Go</a>
  </div>
  <div class="page__header__center" id="search-parent">
  </div>
  <div class="page__header__right">
  </div>
</header>

  <div id="toc"></div>

  <div class="content">
    <div class="article">
      

<div style="display: flex; justify-content: space-between">
  <h1 class="title">A first window app</h1>
  <a class="edit-link" style="font-size: 80%" href="https://notion.so/e87631a7f8a94e8f92f9114e8e6baf0a" rel="nofollow"
  target="_blank">suggest change</a>
</div>


      
<p>Let&#x27;s build a simple app that shows a list of files in a list view and has a search box for filtering results:
</p>
<p>Full source is <a href="https://github.com/essentialbooks/code/tree/master/go/windows">here</a> with the most relevant code in <a href="https://github.com/essentialbooks/code/blob/master/go/windows/file_manager.go">file_manager.go</a>.
</p>
<p>The app is the simplest file manager. It shows the files in the directory, allows navigating file system and limiting files shown to only those matching text entered in the edit control.
</p>
<div id="14363c23-2126-45d6-9707-c447517a19ff" class="column-list">
<div id="c484fe50-f7f4-4772-b6a8-65595d917ec9" style="width:50%" class="column">
<p>Showing all files in directory:
</p>
<img class="img" src="/essential/go/img/9696891720044e3029ce626c6db544111663513e.png">
</div>
<div id="4706353a-a7ae-4c59-8909-ece4493b6a1b" style="width:50%" class="column">
<p>Showing only files matching <code>go</code>:
</p>
<img class="img" src="/essential/go/img/cc0b205e8ca772e5c12ad2ce2e2df7ff67032de6.png">
</div>
</div>
  <h1 id="5566d847-0fef-42af-856d-b87d8a0c9648" class="">Defining window layout
  <a class="header-anchor" href="#5566d847-0fef-42af-856d-b87d8a0c9648" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Let&#x27;s define <code>FileManager</code> struct responsible for managing of the window:
</p>

<div class="code-box lang-Go">
	<div>
	<pre class="chroma"><span class="c1">// FileManager manages file manager window
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">FileManager</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">window</span>         <span class="o">*</span><span class="nx">walk</span><span class="p">.</span><span class="nx">MainWindow</span>
	<span class="nx">fileFilterEdit</span> <span class="o">*</span><span class="nx">walk</span><span class="p">.</span><span class="nx">LineEdit</span>
	<span class="nx">dirLabel</span>       <span class="o">*</span><span class="nx">walk</span><span class="p">.</span><span class="nx">Label</span>
	<span class="nx">filesListBox</span>   <span class="o">*</span><span class="nx">walk</span><span class="p">.</span><span class="nx">ListBox</span>
	<span class="c1">// ... more fields
</span><span class="c1"></span><span class="p">}</span></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>The window consists of 3 widgets, arranged in a vertical list:
</p>
  <ul id="fd8b8bf8-4997-4036-961c-e28f4c8d8eae" class="bulleted-list">
    <li><code>LineEdit</code> for entering a filter that will limit what files are displayed in the files list
    </li>
    <li><code>Label</code> for showing current directory
    </li>
    <li><code>ListBox</code> for showing list of files and directories in a current directory
    </li>
  </ul>
<p>Walk has 2 layers:
</p>
  <ul id="a86ae253-e662-4d3e-b099-68548a11723a" class="bulleted-list">
    <li>widgets that are wrappers around win32 Windows controls e.g. <code>walk.LineEdit</code> is a wrapper around Windows <a href="https://docs.microsoft.com/en-us/windows/desktop/controls/edit-controls">edit control</a>.
    </li>
    <li>an optional declarative system for easily defining the layout of a Window
    </li>
  </ul>
<p>Here&#x27;s a declarative layout of the above window:
</p>

<div class="code-box lang-Go">
	<div>
	<pre class="chroma"><span class="kd">var</span> <span class="nx">fm</span> <span class="nx">FileManager</span>
<span class="nx">def</span> <span class="o">:=</span> <span class="nx">declarative</span><span class="p">.</span><span class="nx">MainWindow</span><span class="p">{</span>
	<span class="nx">AssignTo</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">fm</span><span class="p">.</span><span class="nx">window</span><span class="p">,</span>
	<span class="nx">Title</span><span class="p">:</span>    <span class="s">&#34;File Manageer&#34;</span><span class="p">,</span>
	<span class="nx">MinSize</span><span class="p">:</span>  <span class="nx">declarative</span><span class="p">.</span><span class="nx">Size</span><span class="p">{</span><span class="nx">Width</span><span class="p">:</span> <span class="mi">240</span><span class="p">,</span> <span class="nx">Height</span><span class="p">:</span> <span class="mi">200</span><span class="p">},</span>
	<span class="nx">Size</span><span class="p">:</span>     <span class="nx">declarative</span><span class="p">.</span><span class="nx">Size</span><span class="p">{</span><span class="nx">Width</span><span class="p">:</span> <span class="mi">320</span><span class="p">,</span> <span class="nx">Height</span><span class="p">:</span> <span class="mi">400</span><span class="p">},</span>
	<span class="nx">Layout</span><span class="p">:</span>   <span class="nx">declarative</span><span class="p">.</span><span class="nx">VBox</span><span class="p">{},</span>
	<span class="nx">Children</span><span class="p">:</span> <span class="p">[]</span><span class="nx">declarative</span><span class="p">.</span><span class="nx">Widget</span><span class="p">{</span>
		<span class="nx">declarative</span><span class="p">.</span><span class="nx">LineEdit</span><span class="p">{</span>
			<span class="nx">AssignTo</span><span class="p">:</span>      <span class="o">&amp;</span><span class="nx">fm</span><span class="p">.</span><span class="nx">fileFilterEdit</span><span class="p">,</span>
			<span class="nx">Visible</span><span class="p">:</span>       <span class="kc">true</span><span class="p">,</span>
			<span class="nx">CueBanner</span><span class="p">:</span>     <span class="s">&#34;Enter file filter&#34;</span><span class="p">,</span>
			<span class="nx">OnTextChanged</span><span class="p">:</span> <span class="nx">fm</span><span class="p">.</span><span class="nx">onFilterChanged</span><span class="p">,</span>
			<span class="nx">OnKeyUp</span><span class="p">:</span> <span class="kd">func</span><span class="p">(</span><span class="nx">key</span> <span class="nx">walk</span><span class="p">.</span><span class="nx">Key</span><span class="p">)</span> <span class="p">{</span>
				<span class="k">if</span> <span class="nx">key</span> <span class="o">==</span> <span class="nx">walk</span><span class="p">.</span><span class="nx">KeyEscape</span> <span class="p">{</span>
					<span class="nx">fm</span><span class="p">.</span><span class="nx">fileFilterEdit</span><span class="p">.</span><span class="nf">SetText</span><span class="p">(</span><span class="s">&#34;&#34;</span><span class="p">)</span>
				<span class="p">}</span>
			<span class="p">},</span>
		<span class="p">},</span>
		<span class="nx">declarative</span><span class="p">.</span><span class="nx">Label</span><span class="p">{</span>
			<span class="nx">AssignTo</span><span class="p">:</span> <span class="o">&amp;</span><span class="nx">fm</span><span class="p">.</span><span class="nx">dirLabel</span><span class="p">,</span>
			<span class="nx">Visible</span><span class="p">:</span>  <span class="kc">true</span><span class="p">,</span>
			<span class="nx">Text</span><span class="p">:</span>     <span class="s">&#34;Directory:&#34;</span><span class="p">,</span>
		<span class="p">},</span>
		<span class="nx">declarative</span><span class="p">.</span><span class="nx">ListBox</span><span class="p">{</span>
			<span class="nx">AssignTo</span><span class="p">:</span>        <span class="o">&amp;</span><span class="nx">fm</span><span class="p">.</span><span class="nx">filesListBox</span><span class="p">,</span>
			<span class="nx">Visible</span><span class="p">:</span>         <span class="kc">true</span><span class="p">,</span>
			<span class="nx">OnItemActivated</span><span class="p">:</span> <span class="nx">fm</span><span class="p">.</span><span class="nx">onFileClicked</span><span class="p">,</span>
		<span class="p">},</span>
	<span class="p">},</span>
<span class="p">}</span></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Each widget has a corresponding declarative definition e.g. <code>declarative.LineEdit</code> corresponds to <code>walk.LineEdit</code>.
</p>
<p>A <code>declarative.MainWindow</code> corresponds to top-level window.
</p>
<p>Some widgets, like <code>MainWindow</code> can have children (which are also widgets). For those widgets <code>Layout</code> specifies how children are arranged inside the parent. We use a <code>VBox</code> layout which arranges widgets in a vertical list.
</p>
  <h1 id="512b882c-184e-487a-a3ae-51898a5a8518" class="">Creating a window
  <a class="header-anchor" href="#512b882c-184e-487a-a3ae-51898a5a8518" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>To create window and its widgets we call:
</p>

<div class="code-box lang-Go">
	<div>
	<pre class="chroma"><span class="nx">err</span> <span class="o">:=</span> <span class="nx">def</span><span class="p">.</span><span class="nf">Create</span><span class="p">()</span>
<span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
	<span class="k">return</span> <span class="kc">nil</span><span class="p">,</span> <span class="nx">err</span>
<span class="p">}</span></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>This creates actual widgets based on declarative definition. During creation we can set initial properties on the widget and provide handlers for events generated by widgets.
</p>
<p><code>AssignTo</code> will set a given variable to a created widget, which allows us to manipulate the real widget in the future.
</p>
<p><code>Visible</code> allows to set the initial visibility state of the widget.
</p>
<p><code>Text</code> specifies initial text of <code>Label</code> widget.
</p>
<p><code>CueBanner</code> is a text displayed in <code>LineEdit</code> when its text is empty and the control doesn&#x27;t have focus.
</p>
<p><code>OnTextChanged</code> is an event handler that will be called when text in <code>LineEdit</code> changes.
</p>
<p><code>OnItemActivated</code> is an event handler that will be called when user double-clicks on a list item.
</p>
  <h1 id="6bed5e72-f511-43e0-9a39-adc0a58510c2" class="">Running event loop
  <a class="header-anchor" href="#6bed5e72-f511-43e0-9a39-adc0a58510c2" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Windows GUI is event based. After we create a window, we need to run event loop which ensures processing of window messages:
</p>

<div class="code-box lang-Go">
	<div>
	<pre class="chroma"><span class="nx">_</span> <span class="p">=</span> <span class="nx">fm</span><span class="p">.</span><span class="nx">window</span><span class="p">.</span><span class="nf">Run</span><span class="p">()</span></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Event loop finishes when the user closes the window.
</p>
<p>Further execution of program logic happens as a result of responding to events generated by the user interacting with the widgets.
</p>
  <h1 id="d3b4b1db-9eb8-401c-b176-f2218bc6b3f7" class="">Thread-safe access to widget via synchronization
  <a class="header-anchor" href="#d3b4b1db-9eb8-401c-b176-f2218bc6b3f7" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>On Windows only the thread that created a given window / control can safely operate on this window / control. In most cases it&#x27;s the main thread of the application, called UI thread.
</p>
<p>Walk inherits this limitation. Calling any method on a widget needs to be done on UI thread. If the code runs in a goroutine and manipulates widgets, it must be executed on the right thread. Use <code>widget.Synchronize(fn)</code> to schedule arbitrary function to  be executed on UI thread.
</p>
<p>Crashes are often a result of not observing that rule.
</p>
  <h1 id="3aef20e2-e640-4d47-bd8b-8f60f9e730e0" class="">Handling events
  <a class="header-anchor" href="#3aef20e2-e640-4d47-bd8b-8f60f9e730e0" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Some widgets broadcast events based on user interaction. We can provide functions to be called when an event happens.
</p>
<p><code>LineEdit</code> widget broadcasts <code>OnTextChanged</code> event when a text in edit widget changes. In our application we retrieve the text and use it to filter list of files to only show those that match the text:
</p>

<div class="code-box lang-Go">
	<div>
	<pre class="chroma"><span class="kd">func</span> <span class="p">(</span><span class="nx">fm</span> <span class="o">*</span><span class="nx">FileManager</span><span class="p">)</span> <span class="nf">onFilterChanged</span><span class="p">()</span> <span class="p">{</span>
	<span class="nx">filter</span> <span class="o">:=</span> <span class="nx">fm</span><span class="p">.</span><span class="nx">fileFilterEdit</span><span class="p">.</span><span class="nf">Text</span><span class="p">()</span>
	<span class="nx">fm</span><span class="p">.</span><span class="nf">applyFileFilter</span><span class="p">(</span><span class="nx">filter</span><span class="p">)</span>
<span class="p">}</span></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p><code>ListBox</code> widget broadcasts <code>OnItemActivated</code> event when a list item is activated e.g. with mouse double-click. We can retrieve the item selected with:
</p>

<div class="code-box lang-Go">
	<div>
	<pre class="chroma"><span class="nx">idx</span> <span class="o">:=</span> <span class="nx">fm</span><span class="p">.</span><span class="nx">filesListBox</span><span class="p">.</span><span class="nf">CurrentIndex</span><span class="p">()</span></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>In our case we use it to navigate the directory hierarchy when user double-clicks a directory name.
</p>
  <h1 id="b85ea631-1592-43d5-a118-d8c35d9e2626" class="">Setting the content of a label
  <a class="header-anchor" href="#b85ea631-1592-43d5-a118-d8c35d9e2626" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>A <code>Label</code> is a simple widget that displays a line of text, which we can set with:
</p>

<div class="code-box lang-Go">
	<div>
	<pre class="chroma"><span class="nx">fm</span><span class="p">.</span><span class="nx">dirLabel</span><span class="p">.</span><span class="nf">SetText</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
  <h1 id="a312ad58-6125-463d-8bc4-36236b4b549a" class="">Setting the content of ListBox
  <a class="header-anchor" href="#a312ad58-6125-463d-8bc4-36236b4b549a" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Some widgets, like <code>ListBox</code> or <code>TreeView</code> show more complicated content like a list or tree of items.
</p>
<p>For <code>ListBox</code> the content is abstracted as <code>ListModel</code>. It&#x27;s an interface that you implement to provide information about the list data.
</p>
<p>Walk handles simple cases for us. For example we can use a slice of strings <code>[]string{}</code> as a model:
</p>

<div class="code-box lang-Go">
	<div>
	<pre class="chroma"><span class="nx">model</span> <span class="o">:=</span> <span class="p">[]</span><span class="kt">string</span><span class="p">{</span><span class="s">&#34;item1&#34;</span><span class="p">,</span> <span class="s">&#34;item2&#34;</span><span class="p">}</span>
<span class="nx">listBox</span><span class="p">.</span><span class="nf">SetModel</span><span class="p">(</span><span class="nx">model</span><span class="p">)</span></pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
  <h1 id="55278934-3af7-4064-9ff1-025d622c456a" class="">Application logic
  <a class="header-anchor" href="#55278934-3af7-4064-9ff1-025d622c456a" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>You can study the <a href="https://github.com/essentialbooks/code/blob/master/go/windows/file_manager.go">rest of the code</a> to see how to tie different pieces together.
</p>
<p>The high-level description is:
</p>
  <ul id="d74c0025-448e-4aff-b2bb-75f18f0f9ae6" class="bulleted-list">
    <li>we remember the name of the current directory in <code>FileManager.dir</code> and display it in <code>FileManager.dirLabel</code> widget of type <code>walk.Label</code>
    </li>
    <li>when user double-clicks name of directory in the <code>ListBox</code>, we get a list of files / directories in that directory on a goroutine (so that we don&#x27;t block the UI). When that is finished we <code>Synchronize()</code> the code to update <code>ListBox</code> with list of of files
    </li>
    <li>when user changes a filter in <code>FileManager.fileFilterEdit</code> edit box, we limit displayed files to those that match the filter
    </li>
    <li>when user presses <code>Esc</code> when in <code>fileFilterEdit</code>, we clear the file filter. It&#x27;s one of those little touches that make software more enjoyable for users.
    </li>
  </ul>
  <h1 id="ddb74856-cec0-4cba-8742-14c50b95dd1d" class="">Compiling as a windows application
  <a class="header-anchor" href="#ddb74856-cec0-4cba-8742-14c50b95dd1d" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 8"><path d="M5.88.03c-.18.01-.36.03-.53.09-.27.1-.53.25-.75.47a.5.5 0 1 0 .69.69c.11-.11.24-.17.38-.22.35-.12.78-.07 1.06.22.39.39.39 1.04 0 1.44l-1.5 1.5c-.44.44-.8.48-1.06.47-.26-.01-.41-.13-.41-.13a.5.5 0 1 0-.5.88s.34.22.84.25c.5.03 1.2-.16 1.81-.78l1.5-1.5c.78-.78.78-2.04 0-2.81-.28-.28-.61-.45-.97-.53-.18-.04-.38-.04-.56-.03zm-2 2.31c-.5-.02-1.19.15-1.78.75l-1.5 1.5c-.78.78-.78 2.04 0 2.81.56.56 1.36.72 2.06.47.27-.1.53-.25.75-.47a.5.5 0 1 0-.69-.69c-.11.11-.24.17-.38.22-.35.12-.78.07-1.06-.22-.39-.39-.39-1.04 0-1.44l1.5-1.5c.4-.4.75-.45 1.03-.44.28.01.47.09.47.09a.5.5 0 1 0 .44-.88s-.34-.2-.84-.22z"></path></svg></a>
  </h1>
<p>Compiling the program as a valid Windows application is a bit more involved than a regular Go program.
</p>
<p>For modern Windows applications you need a manifest. You can re-use <a href="https://github.com/essentialbooks/code/blob/master/go/windows/app.manifest">this manifest</a> for most apps.
</p>
<p>In short it declares that the application is compatible with all Windows versions and that it opts in to modern look of controls by asking for version 6 of common controls library.
</p>
<p>A manifest must be embedded into an <code>.exe</code> as a resource.
</p>
<p>To achieve that:
</p>
  <ul id="02d25675-191d-4490-b7dc-6f818442cdb1" class="bulleted-list">
    <li>install <a href="https://github.com/akavel/rsrc">rsrc</a> tool by e.g. doing <code>go get -u </code><code><a href="https://github.com/akavel/rsrc">https://github.com/akavel/rsrc</a></code>, which should download the source code, build <code>rsrc.exe</code> and copy it <code>%GOPATH%\bin</code>, which should be in your <code>%PATH%</code>. If <code>go get</code> fails, you can download the code locally with <code>git clone </code><code><a href="https://github.com/akavel/rsrc.git">https://github.com/akavel/rsrc.git</a></code>, build with <code>go build</code> and copy <code>rsrc.exe</code> somewhere in the <code>%PATH%</code>.
    </li>
    <li>run <code>rsrc -manifest app.manifest -o rsrc.syso</code> to create <code>rsrc.syso</code> file that the go linker will embed as a resource
    </li>
    <li>run <code>go build -ldflags=&quot;-H windowsgui&quot; -o app.exe .</code>
    </li>
  </ul>
<p>The argument <code>ldflags=&quot;-H windowsgui&quot;</code> to <code>go build</code> passes <code>-H windowsgui</code> flag to the linker. 
</p>
<p>This flag marks executable as a Windows GUI application (as opposed to the default console application).
</p>
<p>If you don&#x27;t embed the manifest in the application, it might fail to start in one of two ways:
</p>
  <ul id="73f194b5-02ed-425f-8511-a2992e0c4a36" class="bulleted-list">
    <li>If you compiled as a modern Windows app (i.e., with <code>-H windowsgui</code>), the app will fail silently.
    </li>
    <li>If you compiled as a non-Windows app (i.e., without <code>-H windowsgui</code>), you might get an error <code>TTM_ADDTOOL failed</code> printed to the console.
    </li>
  </ul>
<p>
</p>

      <div class="forum-link">
  Found a mistake? Have a question or improvement idea?
  <a href="#" onclick="showContact(); return false;">Let me know</a>.
</div>

      <form id="contact-form" action="https://formsubmit.co/kkowalczyk@gmail.com" method="POST">
  <p>
    <div class="contact-light">Feedback about page:</div>
    <input type="text" name="page-url" id="contact-page-url" readonly />
  </p>

  <p>
    <div class="contact-light">Feedback:</div>
    <textarea name="message" id="msg-for-chris"></textarea>
    <div class="contact-light">Optional: your email if you want me to get back to you: </div>
    <input type="email" name="email" />
    <input type="text" name="_honey" style="display:none">
  </p>

  <p>
    <button type="submit" class="contact-btn">
      Send Feedback
    </button>

    <button class="contact-btn" style="float: right;" onclick="hideContact(); return false;">
      Cancel
    </button>
  </p>

  <p>
    <div data-netlify-recaptcha></div>
  </p>
</form>


      <hr class="article-bottom-sep">
    </div>

    <div id="page-toc"></div>

    <div id="chapter-toc-wrapper">
      <hr />
      <div class="hdr">Table Of Contents</div>
      <div id="book-toc"></div>
    </div>
  </div>

  <footer class="page__footer">
  <div class="page__footer__left">
    Maintained by
    <a href="https://blog.kowalczyk.info" target="_blank">Krzysztof Kowalczyk</a>
  </div>
  <div class="share-me">
    <a href="https://twitter.com/intent/tweet?text=%22Essential%20Go%22%20-%20a%20free%20programming%20book&url=https%3a%2f%2fwww.programming-books.io%2fessential%2fgo%2f&via=kjk">Share
      <b>Essential Go</b> on&nbsp;
      <svg class="icon-twitter">
        <use xlink:href="#icon-twitter"></use>
      </svg>
    </a>
  </div>
  <div class="page__footer__right">
    
  </div>
</footer>

  

</body>

</html>