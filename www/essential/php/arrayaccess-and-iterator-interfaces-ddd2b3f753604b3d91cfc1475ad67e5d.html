<!doctype html>
<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="referrer" content="always">

  <meta name="twitter:card" value="summary">
  <meta name="twitter:site" content="@kjk">
  <meta name="twitter:title" content="ArrayAccess and Iterator Interfaces">
  
  <meta name="twitter:description" content="ArrayAccess and Iterator Interfaces">
  <meta name="twitter:creator" content="@kjk">
  <meta name="twitter:image" content="https://www.programming-books.io/covers/twitter/PHP.png">
  
  <meta property="og:title" content="ArrayAccess and Iterator Interfaces">
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://www.programming-books.io/essential/php/arrayaccess-and-iterator-interfaces-ddd2b3f753604b3d91cfc1475ad67e5d" />
  
  <meta property="og:description" content="ArrayAccess and Iterator Interfaces">
  <meta property="og:image" content="https://www.programming-books.io/covers/twitter/PHP.png">

  <title>Arrays / ArrayAccess and Iterator Interfaces / Essential PHP</title>
  <meta name="description" content="Arrays / ArrayAccess and Iterator Interfaces / Essential PHP">
  <link rel="icon" href="/s/favicon.ico">
  <link href="/s/main.css" rel="stylesheet">
  <link href="/s/bundle.css" rel="stylesheet">
  <script src="/s/app-php.js" defer></script>
  <script src="/s/bundle.js" defer></script>
</head>

<body class="page">
  <script>
  function onLoad() {
    gBookTitle = "Essential PHP";

    httpsMaybeRedirect();

    let opts = {
      target: document.getElementById("toc"),
      props: {
        parentIdx: -1,
        level: 0,
      },
    };
    new app.toc(opts);

    opts = {
      target: document.getElementById("search-parent"),
      props: {
        bookTitle: gBookTitle,
      },
    };
    new app.searchInput(opts);

    opts = {
      target: document.getElementById("page-toc"),
    };
    new app.pageToc(opts);

    opts = {
      target: document.getElementById("book-toc"),
    };
    new app.bookToc(opts);
  }
  document.addEventListener('DOMContentLoaded', onLoad);
</script>
  <svg xmlns="http://www.w3.org/2000/svg" style="display: none">
  <symbol id="arrow-expanded" viewbox="0 0 16 16">
    <path fill="%23646465" d="M11 10H5.344L11 4.414V10z" />
  </symbol>

  <symbol id="arrow-not-expanded" viewbox="0 0 16 16">
    <path fill="%23646465" d="M6 4v8l4-4-4-4zm1 2.414L8.586 8 7 9.586V6.414z" />
  </symbol>

  <symbol id="icon-github" viewbox="0 0 496 512">
    <path
      d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z" />
  </symbol>

  <symbol id="icon-home" viewbox="0 0 576 512">
    <path
      d="M488 312.7V456c0 13.3-10.7 24-24 24H348c-6.6 0-12-5.4-12-12V356c0-6.6-5.4-12-12-12h-72c-6.6 0-12 5.4-12 12v112c0 6.6-5.4 12-12 12H112c-13.3 0-24-10.7-24-24V312.7c0-3.6 1.6-7 4.4-9.3l188-154.8c4.4-3.6 10.8-3.6 15.3 0l188 154.8c2.7 2.3 4.3 5.7 4.3 9.3zm83.6-60.9L488 182.9V44.4c0-6.6-5.4-12-12-12h-56c-6.6 0-12 5.4-12 12V117l-89.5-73.7c-17.7-14.6-43.3-14.6-61 0L4.4 251.8c-5.1 4.2-5.8 11.8-1.6 16.9l25.5 31c4.2 5.1 11.8 5.8 16.9 1.6l235.2-193.7c4.4-3.6 10.8-3.6 15.3 0l235.2 193.7c5.1 4.2 12.7 3.5 16.9-1.6l25.5-31c4.2-5.2 3.4-12.7-1.7-16.9z" />
  </symbol>

  <symbol id="icon-twitter" viewbox="0 0 512 512">
    <path
      d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z" />
  </symbol>

  <symbol id="icon-edit" viewbox="0 0 576 512">
    <path
      d="M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z" />
  </symbol>

  <symbol id="icon-star" viewbox="0 0 576 512">
    <path
      d="M528.1 171.5L382 150.2 316.7 17.8c-11.7-23.6-45.6-23.9-57.4 0L194 150.2 47.9 171.5c-26.2 3.8-36.7 36.1-17.7 54.6l105.7 103-25 145.5c-4.5 26.3 23.2 46 46.4 33.7L288 439.6l130.7 68.7c23.2 12.2 50.9-7.4 46.4-33.7l-25-145.5 105.7-103c19-18.5 8.5-50.8-17.7-54.6zM388.6 312.3l23.7 138.4L288 385.4l-124.3 65.3 23.7-138.4-100.6-98 139-20.2 62.2-126 62.2 126 139 20.2-100.6 98z" />
  </symbol>
</svg>
  <header class="page__header">
  <div class="page__header__left">
    <a id="link-home" href="index.html">
      <svg class="icon-home">
        <use xlink:href="#icon-home"></use>
      </svg>
      &nbsp;Essential PHP</a>
  </div>
  <div class="page__header__center" id="search-parent">
  </div>
  <div class="page__header__right">
  </div>
</header>

  <div id="toc"></div>

  <div class="content">
    <div class="article">
      

<div style="display: flex; justify-content: space-between">
  <h1 class="title">ArrayAccess and Iterator Interfaces</h1>
  <a class="edit-link" style="font-size: 80%" href="https://notion.so/ddd2b3f753604b3d91cfc1475ad67e5d" rel="nofollow"
  target="_blank">suggest change</a>
</div>


      
<p>Another useful feature is accessing your custom object collections as arrays in PHP. There are two interfaces available in PHP (&gt;=5.0.0) core to support this: <code>ArrayAccess</code> and <code>Iterator</code>. The former allows you to access your custom objects as array.
</p>
<p><strong>ArrayAccess</strong>
</p>
<p>Assume we have a user class and a database table storing all the users. We would like to create a <code>UserCollection</code> class that will:
</p>
  <ol id="bd005c45-96f9-4bb3-902e-6ffedfaab4c0" class="numbered-list" start="1">
    <li>allow us to address certain user by their username unique identifier
    </li>
    <li>perform basic (not all CRUD, but at least Create, Retrieve and Delete) operations on our users collection
    </li>
  </ol>
<p>Consider the following source (hereinafter we’re using short array creation syntax <code>[]</code> available since version 5.4):
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">class UserCollection implements ArrayAccess {
    protected $_conn;
    
    protected $_requiredParams = [&#39;username&#39;,&#39;password&#39;,&#39;email&#39;];
    
    public function __construct() {
        $config = new Configuration();

        $connectionParams = [
            //your connection to the database
        ];
        
        $this-&gt;_conn = DriverManager::getConnection($connectionParams, $config);
    }
    
    protected function _getByUsername($username) {
        $ret = $this-&gt;_conn-&gt;executeQuery(&#39;SELECT * FROM `User` WHERE `username` IN (?)&#39;,
            [$username]
        )-&gt;fetch();
        
        return $ret;
    }
    
    // START of methods required by ArrayAccess interface
    public function offsetExists($offset) {
        return (bool) $this-&gt;_getByUsername($offset);
    }

    public function offsetGet($offset) {
        return $this-&gt;_getByUsername($offset);
    }

    public function offsetSet($offset, $value) {
        if (!is_array($value)) {
            throw new \Exception(&#39;value must be an Array&#39;);
        }

        $passed = array_intersect(array_values($this-&gt;_requiredParams), array_keys($value));
        if (count($passed) &lt; count($this-&gt;_requiredParams)) {
            throw new \Exception(&#39;value must contain at least the following params: &#39; . implode(&#39;,&#39;, $this-&gt;_requiredParams));
        }
        $this-&gt;_conn-&gt;insert(&#39;User&#39;, $value);
    }

    public function offsetUnset($offset) {
        if (!is_string($offset)) {
            throw new \Exception(&#39;value must be the username to delete&#39;);
        }
        if (!$this-&gt;offsetGet($offset)) {
            throw new \Exception(&#39;user not found&#39;);
        }
        $this-&gt;_conn-&gt;delete(&#39;User&#39;, [&#39;username&#39; =&gt; $offset]);
    }
    // END of methods required by ArrayAccess interface
}</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>then we can :
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">$users = new UserCollection();

var_dump(empty($users[&#39;testuser&#39;]),isset($users[&#39;testuser&#39;]));
$users[&#39;testuser&#39;] = [&#39;username&#39; =&gt; &#39;testuser&#39;, 
                      &#39;password&#39; =&gt; &#39;testpassword&#39;,
                      &#39;email&#39;    =&gt; &#39;test@test.com&#39;];
var_dump(empty($users[&#39;testuser&#39;]), isset($users[&#39;testuser&#39;]), $users[&#39;testuser&#39;]);
unset($users[&#39;testuser&#39;]);
var_dump(empty($users[&#39;testuser&#39;]), isset($users[&#39;testuser&#39;]));</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>which will output the following, assuming there was no <code>testuser</code> before we launched the code:
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">bool(true)
bool(false)
bool(false)
bool(true)
array(17) {
  [&#34;username&#34;]=&gt;
  string(8) &#34;testuser&#34;
  [&#34;password&#34;]=&gt;
  string(12) &#34;testpassword&#34;
  [&#34;email&#34;]=&gt;
  string(13) &#34;test@test.com&#34;
}
bool(true)
bool(false)</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p><strong>IMPORTANT:</strong> <code>offsetExists</code> is not called when you check existence of a key with <code>array_key_exists</code> function. So the following code will output <code>false</code> twice:
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">var_dump(array_key_exists(&#39;testuser&#39;, $users));
$users[&#39;testuser&#39;] = [&#39;username&#39; =&gt; &#39;testuser&#39;, 
                      &#39;password&#39; =&gt; &#39;testpassword&#39;,
                      &#39;email&#39;    =&gt; &#39;test@test.com&#39;];
var_dump(array_key_exists(&#39;testuser&#39;, $users));</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p><strong>Iterator</strong>
</p>
<p>Let’s extend our class from above with a few functions from <code>Iterator</code> interface to allow iterating over it with <code>foreach</code> and <code>while</code>.
</p>
<p>First, we need to add a property holding our current index of iterator, let’s add it to the class properties as <code>$_position</code>:
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">// iterator current position, required by Iterator interface methods
protected $_position = 1;</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>Second, let’s add <code>Iterator</code> interface to the list of interfaces being implemented by our class:
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">class UserCollection implements ArrayAccess, Iterator {</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>then add the required by the interface functions themselves:
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">// START of methods required by Iterator interface
public function current () {
    return $this-&gt;_getById($this-&gt;_position);
}
public function key () {
    return $this-&gt;_position;
}
public function next () {
    $this-&gt;_position++;
}
public function rewind () {
    $this-&gt;_position = 1;
}
public function valid () {
    return null !== $this-&gt;_getById($this-&gt;_position);
}
// END of methods required by Iterator interface</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>So all in all here is complete source of the class implementing both interfaces. Note that this example is not perfect, because the IDs in the database may not be sequential, but this was written just to give you the main idea: you can address your objects collections in any possible way by implementing <code>ArrayAccess</code> and <code>Iterator</code> interfaces:
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">class UserCollection implements ArrayAccess, Iterator {
    // iterator current position, required by Iterator interface methods
    protected $_position = 1;
    
    // &lt;add the old methods from the last code snippet here&gt;
    
    // START of methods required by Iterator interface
    public function current () {
        return $this-&gt;_getById($this-&gt;_position);
    }
    public function key () {
        return $this-&gt;_position;
    }
    public function next () {
        $this-&gt;_position++;
    }
    public function rewind () {
        $this-&gt;_position = 1;
    }
    public function valid () {
        return null !== $this-&gt;_getById($this-&gt;_position);
    }
    // END of methods required by Iterator interface
}</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>and a foreach looping through all user objects:
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">foreach ($users as $user) {
    var_dump($user[&#39;id&#39;]);
}</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>
<p>which will output something like
</p>

<div class="code-box lang-Plain Text">
	<div>
	<pre class="chroma">string(2) &#34;1&#34;
string(2) &#34;2&#34;
string(2) &#34;3&#34;
string(2) &#34;4&#34;
...</pre>
	</div>
	<div class="code-box-nav">
		
	</div>
</div>

      <div class="forum-link">
  Found a mistake? Have a question or improvement idea?
  <a href="#" onclick="showContact(); return false;">Let me know</a>.
</div>

      <form id="contact-form" action="https://formsubmit.co/kkowalczyk@gmail.com" method="POST">
  <p>
    <div class="contact-light">Feedback about page:</div>
    <input type="text" name="page-url" id="contact-page-url" readonly />
  </p>

  <p>
    <div class="contact-light">Feedback:</div>
    <textarea name="message" id="msg-for-chris"></textarea>
    <div class="contact-light">Optional: your email if you want me to get back to you: </div>
    <input type="email" name="email" />
    <input type="text" name="_honey" style="display:none">
  </p>

  <p>
    <button type="submit" class="contact-btn">
      Send Feedback
    </button>

    <button class="contact-btn" style="float: right;" onclick="hideContact(); return false;">
      Cancel
    </button>
  </p>

  <p>
    <div data-netlify-recaptcha></div>
  </p>
</form>


      <hr class="article-bottom-sep">
    </div>

    <div id="page-toc"></div>

    <div id="chapter-toc-wrapper">
      <hr />
      <div class="hdr">Table Of Contents</div>
      <div id="book-toc"></div>
    </div>
  </div>

  <footer class="page__footer">
  <div class="page__footer__left">
    Maintained by
    <a href="https://blog.kowalczyk.info" target="_blank">Krzysztof Kowalczyk</a>
  </div>
  <div class="share-me">
    <a href="https://twitter.com/intent/tweet?text=%22Essential%20PHP%22%20-%20a%20free%20programming%20book&url=https%3a%2f%2fwww.programming-books.io%2fessential%2fphp%2f&via=kjk">Share
      <b>Essential PHP</b> on&nbsp;
      <svg class="icon-twitter">
        <use xlink:href="#icon-twitter"></use>
      </svg>
    </a>
  </div>
  <div class="page__footer__right">
    
  </div>
</footer>

  

</body>

</html>